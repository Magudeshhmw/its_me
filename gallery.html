<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/jpeg" href="me.jpg">
    <title>Image Gallery - Magudeshwaran (HMW)</title>
    <meta name="description"
        content="View the complete image gallery of Magudeshwaran (HMW)'s achievements, certificates, and project highlights.">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- Schema.org -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "ImageGallery",
      "name": "Magudeshwaran's Achievements Gallery",
      "description": "A collection of certificates and achievement images.",
      "author": {
        "@type": "Person",
        "name": "Magudeshwaran (HMW)"
      }
    }
    </script>

    <style>
        :root {
            --primary-500: #06b6d4;
            --primary-600: #0891b2;
            --primary-400: #22d3ee;
            --slate-900: #0f172a;
            --slate-800: #1e293b;
            --slate-300: #cbd5e1;
            --slate-400: #94a3b8;
            --slate-500: #64748b;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }

        body {
            background-color: var(--slate-900);
            background-image: radial-gradient(circle at 50% 0%, rgba(6, 182, 212, 0.1), transparent 70%);
            color: white;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            /* Wider for gallery view */
            margin: 0 auto;
            padding: 0 1.5rem;
        }

        nav {
            padding: 1.5rem 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .back-btn {
            color: var(--slate-300);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 500;
            transition: color 0.3s;
        }

        .back-btn:hover {
            color: var(--primary-400);
        }

        header {
            text-align: center;
            padding: 3rem 0;
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, white, var(--slate-300));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Album Section Styles */
        .album-section {
            margin-bottom: 4rem;
        }

        .album-title {
            font-size: 1.75rem;
            font-weight: 600;
            color: var(--slate-300);
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid rgba(148, 163, 184, 0.1);
            text-transform: capitalize;
        }

        .album-date {
            font-size: 0.9rem;
            color: var(--slate-500);
            margin-left: 1rem;
            font-weight: normal;
        }

        /* Google Photos Style Grid */
        .gallery-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            /* Tight gap */
        }

        .gallery-item {
            height: 300px;
            /* Base row height */
            flex-grow: 1;
            position: relative;
            cursor: pointer;
            overflow: hidden;
            border-radius: 2px;
        }

        @media (max-width: 768px) {
            .gallery-item {
                height: 150px;
            }
        }

        .gallery-item:hover img {
            filter: brightness(1.1);
        }

        .gallery-item img {
            height: 100%;
            width: 100%;
            object-fit: cover;
            min-width: 100%;
            vertical-align: bottom;
            transition: filter 0.2s;
        }

        /* Fix for last row stretching */
        /* This prevents the last item from growing HUGE if it's alone */
        .gallery-grid::after {
            content: '';
            flex-grow: 1000000;
        }

        .loader {
            text-align: center;
            padding: 4rem;
            color: var(--slate-300);
        }
    </style>
</head>

<body>
    <div class="container">
        <nav>
            <a href="index.html" class="back-btn"><i class="fas fa-arrow-left"></i> Back to Portfolio</a>
        </nav>

        <header>
            <h1>Gallery</h1>
            <p style="color: var(--slate-400);">Snapshots of my journey, achievements, and projects.</p>
        </header>

        <div id="gallery-container">
            <div class="loader">Loading albums from GitHub...</div>
        </div>
    </div>

    <script>
        const user = 'Magudeshhmw';
        const repo = 'its_me';
        const targetPath = 'sample/image';

        async function fetchGallery() {
            const container = document.getElementById('gallery-container');
            const schemaDataImages = [];

            try {
                // Use Tree API for recursive fetch (efficient)
                const response = await fetch(`https://api.github.com/repos/${user}/${repo}/git/trees/main?recursive=1`);

                if (!response.ok) {
                    throw new Error('Failed to load gallery data from GitHub');
                }

                const data = await response.json();

                // Filter files inside sample/image
                const galleryFiles = data.tree.filter(item =>
                    item.path.startsWith(targetPath) &&
                    (item.path.match(/\.(jpg|jpeg|png|gif|webp)$/i))
                );

                if (galleryFiles.length === 0) {
                    container.innerHTML = '<div class="loader">No images found in the repository.</div>';
                    return;
                }

                // Group by Subfolder (Album Title)
                const albums = {};

                galleryFiles.forEach(file => {
                    // Extract relative path after targetPath
                    // format: sample/image/AlbumName/image.jpg

                    const relativePath = file.path.substring(targetPath.length + 1); // +1 for slash
                    const parts = relativePath.split('/');

                    let albumName = "General"; // Default if at root - Changed from "Recent Uploads"

                    if (parts.length > 1) {
                        albumName = parts[0];
                    }

                    if (!albums[albumName]) {
                        albums[albumName] = [];
                    }

                    // Construct raw GitHub URL
                    const downloadUrl = `https://raw.githubusercontent.com/${user}/${repo}/main/${file.path}`;

                    albums[albumName].push({
                        url: downloadUrl,
                        path: file.path,
                        name: parts[parts.length - 1]
                    });

                    schemaDataImages.push(downloadUrl);
                });

                container.innerHTML = ''; // Clear loader

                const albumKeys = Object.keys(albums);

                // Render Albums
                albumKeys.forEach(albumName => {
                    const section = document.createElement('div');
                    section.className = 'album-section';

                    // Decode URI component for folder names with %20
                    const displayName = decodeURIComponent(albumName).replace(/[-_]/g, ' ');

                    // Only show header if there are multiple albums OR the name is not the default "General"
                    // If it's just "General" images (single album), we hide the header for a cleaner look.
                    let headerHTML = '';
                    if (albumKeys.length > 1 || albumName !== "General") {
                        headerHTML = `
                            <h2 class="album-title">
                                ${displayName} 
                                <span class="album-date">${albums[albumName].length} items</span>
                            </h2>
                        `;
                    }

                    let gridHTML = '<div class="gallery-grid">';
                    albums[albumName].forEach(img => {
                        gridHTML += `
                            <a href="${img.url}" target="_blank" class="gallery-item">
                                <img src="${img.url}" alt="${displayName}" loading="lazy">
                            </a>
                         `;
                    });
                    gridHTML += '</div>';

                    section.innerHTML = headerHTML + gridHTML;
                    container.appendChild(section);
                });

                // Update Schema
                updateSchema(schemaDataImages);

            } catch (error) {
                console.error(error);
                container.innerHTML = `<div class="loader">Error loading gallery: ${error.message}</div>`;
            }
        }

        function updateSchema(imageUrls) {
            const schemaScript = document.querySelector('script[type="application/ld+json"]');
            if (schemaScript) {
                const schemaData = JSON.parse(schemaScript.textContent);
                schemaData.image = imageUrls;
                schemaScript.textContent = JSON.stringify(schemaData, null, 2);
            }
        }

        window.onload = fetchGallery;
    </script>
</body>

</html>